<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>JS Drum Kit</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div class="keys">
      <div data-key="65" class="key">
        <kbd>A</kbd> <span class="sound">clap</span>
      </div>
      <div data-key="83" class="key">
        <kbd>S</kbd> <span class="sound">hihat</span>
      </div>
      <div data-key="68" class="key">
        <kbd>D</kbd> <span class="sound">kick</span>
      </div>
      <div data-key="70" class="key">
        <kbd>F</kbd> <span class="sound">openhat</span>
      </div>
      <div data-key="71" class="key">
        <kbd>G</kbd> <span class="sound">boom</span>
      </div>
      <div data-key="72" class="key">
        <kbd>H</kbd> <span class="sound">ride</span>
      </div>
      <div data-key="74" class="key">
        <kbd>J</kbd> <span class="sound">snare</span>
      </div>
      <div data-key="75" class="key">
        <kbd>K</kbd> <span class="sound">tom</span>
      </div>
      <div data-key="76" class="key">
        <kbd>L</kbd> <span class="sound">tink</span>
      </div>
    </div>

    <audio data-key="65" src="sounds/clap.wav"></audio>
    <audio data-key="83" src="sounds/hihat.wav"></audio>
    <audio data-key="68" src="sounds/kick.wav"></audio>
    <audio data-key="70" src="sounds/openhat.wav"></audio>
    <audio data-key="71" src="sounds/boom.wav"></audio>
    <audio data-key="72" src="sounds/ride.wav"></audio>
    <audio data-key="74" src="sounds/snare.wav"></audio>
    <audio data-key="75" src="sounds/tom.wav"></audio>
    <audio data-key="76" src="sounds/tink.wav"></audio>

    <script>
      /**
       * @function: activateKey
       * @description: Play a sweet beat and add some visual feedback for the user
       * to know that their key press was received.
       */
      function activateKey(event) {
        // Find the audio element that matches the pressed key.
        const audioElement = document.querySelector(
          `audio[data-key="${event.keyCode}"]`
        )
        // Find the div element that matches the pressed key.
        const keyDiv = document.querySelector(
          `.key[data-key="${event.keyCode}"]`
        )

        // If we weren't able to find an audio element, there's no point in continuing.
        if (!audioElement) {
          console.log('Unable to find a sound for that key')
          return
        }

        // Going to be strict, and not continue if we can't find the visual element either.
        // This keeps us from getting an error when we try to add a class to this element.
        if (!keyDiv) {
          console.log('Unable to find a visual element for that key')
          return
        }

        audioElement.currentTime = 0 // Make sure we start at the beginning every time
        audioElement.play()

        // Give the user some visual feedback that they pressed a recognized key
        keyDiv.classList.add('playing')
      }

      /**
       * @function: deactivateKey
       * @description: fired after a css transition on a known element completes - check to
       * ensure it was a transform, and then remove the 'playing' class
       */
      function deactivateKey(event) {
        if (event.propertyName !== 'transform') {
          return
        }

        this.classList.remove('playing') // 'this' references the watched element.
      }

      const allVisualKeys = document.querySelectorAll('.key')

      // Add listeners to each known key that deactivates them whenever the CSS
      // has completed its animations.
      allVisualKeys.forEach(key =>
        key.addEventListener('transitionend', deactivateKey)
      )

      // Listen for user keydown
      window.addEventListener('keydown', activateKey)
    </script>
  </body>
</html>
